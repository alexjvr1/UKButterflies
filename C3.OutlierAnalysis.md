# Aricia agestis genome scan

Aim: set up code for genome scan between museum and modern, and modern core vs modern expanding

1. Genome scan

2. Sort according to Heliconius gff. 

3. Compare Manhattan plots

4. identify genes



## Prepare the data

The samples in the raw vcf need to be renamed with shorter names. 
```
module load apps/bcftools-1.8

##see the current names
bcftools query -l 

10-AAg-19-1900-10_190312_L005_cutadapt_filtered_R1.fastq.gz
11-AAg-19-1900-11_190312_L005_cutadapt_filtered_R1.fastq.gz
12-AAg-19-1900-12_190312_L005_cutadapt_filtered_R1.fastq.gz
...

##Create a file with two columns: old_name new_name

nano C3.newnames

10-AAg-19-1900-10_190312_L005_cutadapt_filtered_R1.fastq.gz	AAg-19-1900-10_museum
11-AAg-19-1900-11_190312_L005_cutadapt_filtered_R1.fastq.gz	AAg-19-1900-11_museum
12-AAg-19-1900-12_190312_L005_cutadapt_filtered_R1.fastq.gz	AAg-19-1900-12_museum
...

bcftools reheader -s C3.newnames C3.raw.bcf > C3.raw.newnames.bcf
```

The file should be filtered correctly - minimum 18 individuals genotyped in each of the populations (museum, modernCore, modernExp)

The filtering script can be found [here](https://github.com/alexjvr1/UKButterflies/blob/master/03c_variants_filtering_ExpandingPops_July2019.sh)

After filtering generate the intersecting files (ie. vcf for each population with only loci from found in both populations). 

```
bcftools isec -p dir museum_xxx.bcf modern_xxxx.bcf

##for more than two files: 

bcftools isec -p dir -n 3 museum_xxx.bcf modernCore_xxx.bcf modernExp_xxx.bcf
```

Initially we'll use the masked file to compare Fst between annotated loci only
```
module load apps/bedtools2

bedtools subtract -header -a 0002.vcf -b ../../../RefGenome/genome.mod.gff > 0002.masked.vcf

bedtools subtract -header -a 0003.vcf -b ../../../RefGenome/genome.mod.gff > 0003.masked.vcf

## merge all of these files

bcftools view -O b 0002.masked.vcf > 0002.masked.bcf

bcftools view -O b 0003.masked.vcf > 0003.masked.bcf

bcftools merge 0002.masked.bcf 0003.masked.bcf > C3.masked.mus.mod.bcf

```



## Genome scan

We'll use [OutFlank](https://htmlpreview.github.io/?https://github.com/whitlock/OutFLANK/blob/master/inst/doc/OutFLANKAnalysis.html) for the outlier analysis

First select a subset of loci to calculate the neutral Fst

```


```






